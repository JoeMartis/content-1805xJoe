(function(requirejs,require,define){define("app/plotter3D",["require","jquery","webfonts","utils","tool","color","slider","radiobutton","radiobuttongroup","vslider","text","label","richtext","textbox","dropdown","minislider","graph","three"],function(require){var $=require("jquery"),WebFonts=require("webfonts"),U=require("utils"),Tool=require("tool"),Color=require("color"),Slider=require("slider"),RadioButton=require("radiobutton"),RadioButtonGroup=require("radiobuttongroup"),VSlider=require("vslider"),Text=require("text"),Label=require("label"),RichText=require("richtext"),TextBox=require("textbox"),DropDown=require("dropdown"),MiniSlider=require("minislider"),Graph=require("graph");require("three");var tool,lineRb,boxRb,rbGroup,WIDTH=500,HEIGHT=500,VIEW_ANGLE=45,ASPECT=WIDTH/HEIGHT,NEAR=.1,FAR=1e4,container,renderer,camera,scene,controls,directionalLight,ambientLight,matrixValues,paramDisplay,paramSliders,plane1,plane2,plane3,face1,face2,missingLines,axes,ticks;WebFonts.load(initializeTool
);function initializeTool(){try{U.testFor3DRenderer(),initTool(),draw(),animate()}catch(err){window.alert(err.toString()+" The tool is disabled.")}}function loadJSON(){$.ajax({url:"config.json",dataType:"json",success:function(data){$.each(data,function(key,val){window.alert("key="+key+" "+"val="+val)})}})}function initTool(){var daimpCanvas=document.getElementById("daimp");daimpCanvas.onselectstart=function(){return!1};var daimpBuffer=document.createElement("canvas");daimpBuffer.width=daimpCanvas.width,daimpBuffer.height=daimpCanvas.height;var element=daimpCanvas;tool=new Tool(800,800,daimpCanvas,daimpBuffer,element),lineRb=new RadioButton(50,50,62,62),lineRb.text="Line axes",lineRb.textColor=Color.white,lineRb.addEventListener("mousedown",radioButtonMouseDown),tool.add(lineRb),boxRb=new RadioButton(50,75,62,87),boxRb.text="Box axes",boxRb.textColor=Color.white,boxRb.isChecked=!0,boxRb.addEventListener("mousedown",radioButtonMouseDown),tool.add(boxRb),rbGroup=new RadioButtonGroup(lineRb
,boxRb);var numPlanes=3,paramsPerPlane=4;matrixValues=new Array(numPlanes);var scale,x,y,z;for(y=0;y<numPlanes;y++){matrixValues[y]=new Array(paramsPerPlane);for(x=0;x<paramsPerPlane;x++)scale=x===3?25:1,matrixValues[y][x]=scale*(Math.random()*2-1)}var basey=150,rowspacing=25,paramXcoords=[50,115,180,245],planeColors=[Color.red,Color.green,Color.blue],labelXcoords=[85,150,215],labelText=["x  +","y  +","z  ="];paramDisplay=new Array(numPlanes),paramSliders=new Array(numPlanes);var tempText,bb,md=function(e){controls.enabled=!1,sliderMouseHandler(e)},mu=function(e){controls.enabled=!0};for(y=0;y<numPlanes;y++){paramDisplay[y]=new Array(paramsPerPlane),paramSliders[y]=new Array(paramsPerPlane);for(x=0;x<paramsPerPlane;x++){paramDisplay[y][x]=new Text(paramXcoords[x],basey+rowspacing*y);var digits=x===3?1:2;paramDisplay[y][x].text=matrixValues[y][x].toFixed(digits),paramDisplay[y][x].col=x,paramDisplay[y][x].row=y,paramDisplay[y][x].addEventListener("mousedown",matrixMouseDown),tool.add(paramDisplay
[y][x]),bb=paramDisplay[y][x].getBB(),paramSliders[y][x]=new MiniSlider(bb.left+Math.floor(bb.width/2),bb.top-1),paramSliders[y][x].col=x,paramSliders[y][x].row=y,paramSliders[y][x].zIndex=paramDisplay[y][x].zIndex+1,paramSliders[y][x].addEventListener("mousedown",md),paramSliders[y][x].addEventListener("mousedrag",sliderMouseHandler),paramSliders[y][x].addEventListener("mouseup",mu),paramSliders[y][x].isVisible=!1,tool.add(paramSliders[y][x]),scale=x===3?25:1,paramSliders[y][x].xmin=-scale,paramSliders[y][x].xmax=scale,paramSliders[y][x].xspan=2*scale,paramSliders[y][x].setValue(matrixValues[y][x])}for(x=0;x<labelText.length;x++)tempText=new Text(labelXcoords[x],basey+rowspacing*y),tempText.text=labelText[x],tempText.textColor=planeColors[y],tool.add(tempText)}container=document.getElementById("container");var container3D=document.createElement("div");container.appendChild(container3D),U.testForWebGL()?renderer=new THREE.WebGLRenderer:renderer=new THREE.CanvasRenderer,renderer.setSize(
WIDTH,HEIGHT),renderer.setClearColor(new THREE.Color(0),1),container3D.appendChild(renderer.domElement);var jq=$(container3D);jq.css({position:"absolute",left:400,top:50}),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR),camera.position.z=500,controls=new THREE.TrackballControls(camera),controls.rotateSpeed=1,controls.zoomSpeed=1.2,controls.panSpeed=.8,controls.noZoom=!1,controls.noPan=!1,controls.staticMoving=!0,controls.dynamicDampingFactor=.3,controls.keys=[65,83,68],controls.addEventListener("change",render);var v=function(x,y,z){return new THREE.Vector3(x,y,z)},axisLen=100,l=axisLen,tickSpacing=20,tickLen=3,axisGeometry=new THREE.Geometry;axisGeometry.vertices.push(v(-axisLen,0,0),v(axisLen,0,0),v(0,-axisLen,0),v(0,axisLen,0),v(0,0,-axisLen),v(0,0,axisLen));var axisMaterial=new THREE.LineBasicMaterial({color:13421772,lineWidth:1});axes=new THREE.Line(axisGeometry,axisMaterial),axes.type=THREE.LinePieces,axes.visible=!1;var face1Geom=new THREE.Geometry
;face1Geom.vertices.push(v(-l,-l,-l),v(-l,l,-l),v(-l,l,l),v(-l,-l,l),v(-l,-l,-l)),face1=new THREE.Line(face1Geom,axisMaterial),face1.type=THREE.LineStrip;var face2Geom=new THREE.Geometry;face2Geom.vertices.push(v(l,-l,-l),v(l,l,-l),v(l,l,l),v(l,-l,l),v(l,-l,-l)),face2=new THREE.Line(face2Geom,axisMaterial),face2.type=THREE.LineStrip;var missingLinesGeom=new THREE.Geometry;missingLinesGeom.vertices.push(v(-l,-l,-l),v(l,-l,-l),v(-l,l,-l),v(l,l,-l),v(-l,l,l),v(l,l,l),v(-l,-l,l),v(l,-l,l)),missingLines=new THREE.Line(missingLinesGeom,axisMaterial),missingLines.type=THREE.LinePieces;var tickGeometry=new THREE.Geometry;for(x=tickSpacing;x<=axisLen;x+=tickSpacing)tickGeometry.vertices.push(v(x,0,0),v(x,0,tickLen),v(-x,0,0),v(-x,0,tickLen),v(0,x,0),v(tickLen,x,0),v(0,-x,0),v(tickLen,-x,0),v(0,0,x),v(tickLen,0,x),v(0,0,-x),v(tickLen,0,-x));var ticks=new THREE.Line(tickGeometry,axisMaterial);ticks.type=THREE.LinePieces;var plotGeometry=new THREE.Geometry,numSamples=20,sampleSpacing=5;for(x=0;x<numSamples
;x++)for(z=0;z<numSamples;z++)plotGeometry.vertices.push(new THREE.Vector3(x*sampleSpacing,0,z*sampleSpacing)),x>0&&z>0&&plotGeometry.faces.push(new THREE.Face4(x-1+(z-1)*numSamples,x+(z-1)*numSamples,x+z*numSamples,x-1+z*numSamples));plotGeometry.dynamic=!0;var plotMaterial=new THREE.MeshBasicMaterial({color:10079487,opacity:.8}),plot=new THREE.Mesh(plotGeometry,plotMaterial);plot.doubleSided=!0,testPlot(plotGeometry,numSamples,sampleSpacing,function(x,z){return Math.exp(-(x*x+z*z)/(axisLen*axisLen)*4)*axisLen/2});var redMat=new THREE.MeshPhongMaterial({color:16711680,ambient:16711680,side:THREE.DoubleSide}),greenMat=new THREE.MeshLambertMaterial({color:65280,ambient:65280,side:THREE.DoubleSide}),blueMat=new THREE.MeshLambertMaterial({color:255,ambient:255,side:THREE.DoubleSide}),planeGeom1=new THREE.PlaneGeometry(100,100),planeGeom2=new THREE.PlaneGeometry(100,100),planeGeom3=new THREE.PlaneGeometry(100,100);plane1=new THREE.Mesh(planeGeom1,redMat),plane2=new THREE.Mesh(planeGeom2,greenMat
),plane3=new THREE.Mesh(planeGeom3,blueMat),updatePlane(0),updatePlane(1),updatePlane(2),directionalLight=new THREE.DirectionalLight(16777215),directionalLight.position.x=10,directionalLight.position.y=10,directionalLight.position.z=10,ambientLight=new THREE.AmbientLight(11184810),scene.add(axes),scene.add(face1),scene.add(face2),scene.add(missingLines),scene.add(camera),scene.add(directionalLight),scene.add(ambientLight),scene.add(plane1),scene.add(plane2),scene.add(plane3)}function testPlot(geom,numSamples,sampleSpacing,f){var x,z,val,i=0;for(x=0;x<numSamples;x++)for(z=0;z<numSamples;z++)val=f(x*sampleSpacing,z*sampleSpacing),geom.vertices[i].y=val,i++}function draw(){tool.setPaintOn("canvas"),tool.paint()}function animate(){window.requestAnimationFrame(animate),controls.update()}function render(){renderer.render(scene,camera)}function radioButtonMouseDown(rb){rbGroup.unselectAll(rb),lineRb.isChecked?(face1.visible=!1,face2.visible=!1,missingLines.visible=!1,axes.visible=!0):(axes.visible=!1
,face1.visible=!0,face2.visible=!0,missingLines.visible=!0),draw(),render()}function matrixMouseDown(param){var x=param.src.col,y=param.src.row;sliderVisibleX===x&&sliderVisibleY===y?hideVisibleSlider():showSlider(x,y)}var sliderVisibleX=-1,sliderVisibleY=-1;function showSlider(x,y){hideVisibleSlider();var md=paramDisplay[y][x];md.storeTextColor=md.textColor,md.textColor=Color.litegray,md.draw(),paramSliders[y][x].isVisible=!0,paramSliders[y][x].draw(),sliderVisibleX=x,sliderVisibleY=y}function hideVisibleSlider(){if(sliderVisibleX>=0){var md=paramDisplay[sliderVisibleY][sliderVisibleX];md.textColor=md.storeTextColor,md.draw();var ms=paramSliders[sliderVisibleY][sliderVisibleX];ms.isVisible=!1,tool.paintBox({left:ms.bBox.left,top:ms.bBox.top,right:ms.bBox.right,bottom:ms.bBox.bottom+ms.anchorTriangleHeight}),sliderVisibleX=-1,sliderVisibleY=-1}}function sliderMouseHandler(param){var x=param.src.col,y=param.src.row;paramDisplay[y][x].clear(),matrixValues[y][x]=paramSliders[y][x].xvalue;var digits=
x===3?1:2;paramDisplay[y][x].text=matrixValues[y][x].toFixed(digits),paramDisplay[y][x].draw(),updatePlane(y)}function updatePlane(which){var m=matrixValues[which],plane=[plane1,plane2,plane3][which];plane.position.set(m[0],m[1],m[2]),plane.position.setLength(m[3]);var lookAtVec=new THREE.Vector3;m[3]===0&&lookAtVec.set(m[0],m[1],m[2]),plane.lookAt(lookAtVec),window.requestAnimationFrame(render,renderer.domElement)}})})(RequireJS.requirejs,RequireJS.require,RequireJS.define)