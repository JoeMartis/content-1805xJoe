(function(requirejs,require,define){define("app/gaussElimination",["require","jquery","webfonts","utils","tool","color","text","textbox","minislider","rowarrow","radiobutton","radiobuttongroup","button"],function(require){var $=require("jquery"),WebFonts=require("webfonts"),U=require("utils"),Tool=require("tool"),Color=require("color"),Text=require("text"),TextBox=require("textbox"),MiniSlider=require("minislider"),RowArrow=require("rowarrow"),RadioButton=require("radiobutton"),RadioButtonGroup=require("radiobuttongroup"),Button=require("button"),tool,matrixdisplay,minisliders,matrixvalues,userMat=[],solMat=[],scalingLabel,scalarInput,rowarrows,ghostBuffer,rowpositions,stagingArrow,stagingDisplay,stagingPosition,radiobuttons,sliderVisibleX=-1,sliderVisibleY=-1,switchRB,multiplyRB,addRB,textSolTitle,textStepsTitle,textSols=[],textSteps=[],errorMsgDisplay,editingDisabled=!1,cols=6,rows=5;WebFonts.load(initializeTool);function initializeTool(){try{U.testForFeatures(!0,!1,!1),initTool(),draw
()}catch(err){window.alert(err.toString()+" The tool is disabled.")}}function loadJSON(){$.ajax({url:"config.json",dataType:"json",success:function(data){$.each(data,function(key,val){window.alert("key="+key+" "+"val="+val)})}})}function initTool(){var daimpCanvas=$("#daimp")[0];daimpCanvas.onselectstart=function(){return!1};var daimpBuffer=document.createElement("canvas");daimpBuffer.width=daimpCanvas.width,daimpBuffer.height=daimpCanvas.height;var container=document.getElementById("container");tool=new Tool(800,800,daimpCanvas,daimpBuffer,$(daimpCanvas),container),switchRB=new RadioButton(100,35,110,45),switchRB.text="Switch",switchRB.isChecked=!0,switchRB.addEventListener("mousedown",radioButtonMouseDown),tool.add(switchRB),multiplyRB=new RadioButton(200,35,210,45),multiplyRB.text="Multiply",multiplyRB.addEventListener("mousedown",radioButtonMouseDown),tool.add(multiplyRB),addRB=new RadioButton(300,35,310,45),addRB.text="Add",addRB.addEventListener("mousedown",radioButtonMouseDown),tool
.add(addRB),radiobuttons=new RadioButtonGroup(switchRB,multiplyRB,addRB),scalingLabel=new Text(100,100),scalingLabel.text="Scaling factor:",tool.add(scalingLabel),scalingLabel.getBB(),scalingLabel.isVisible=!1,scalarInput=new TextBox(200,scalingLabel.bBox.top-2,50),tool.add(scalarInput),scalarInput.setVisibility(!1),scalarInput.node.addEventListener("keydown",function(event){var keycode=event.keyCode||event.charCode,ENTERKEY=13;if(keycode===ENTERKEY){var temp=scalarInput.getFloat();isNaN(temp)&&(this.value=temp=rowmult),rowmult=temp,this.blur()}});var x,y,basex=100,basey=200,rowspacing=25,colspacing=50,bb,middleY;stagingDisplay=new Array(cols);for(x=0;x<cols;x++)stagingDisplay[x]=new Text(100+colspacing*x,150),stagingDisplay[x].text="--",stagingDisplay[x].isVisible=!1,tool.add(stagingDisplay[x]);bb=stagingDisplay[0].getBB(),middleY=(bb.top+bb.bottom)/2,stagingArrow=new RowArrow(bb.left-13,middleY,10,5),stagingArrow.row=-1,stagingArrow.origRow=-1,stagingArrow.isVisible=!1,stagingArrow.addEventListener
("mousedown",arrowMouseDown),tool.add(stagingArrow),stagingPosition={left:stagingArrow.bBox.left,top:bb.top,bottom:bb.bottom,right:200+colspacing*cols},matrixvalues=new Array(rows);for(y=0;y<rows;y++){matrixvalues[y]=new Array(cols);for(x=0;x<cols;x++)matrixvalues[y][x]=Math.random()*2-1}userMat.push(deepCopy(matrixvalues)),solMat.push(deepCopy(matrixvalues)),matrixdisplay=new Array(rows),minisliders=new Array(rows),rowarrows=new Array(rows),rowpositions=new Array(rows);for(y=0;y<rows;y++){matrixdisplay[y]=new Array(cols),minisliders[y]=new Array(cols);for(x=0;x<cols;x++)matrixdisplay[y][x]=new Text(basex+colspacing*x,basey+rowspacing*y),matrixdisplay[y][x].text=matrixvalues[y][x].toFixed(2),matrixdisplay[y][x].col=x,matrixdisplay[y][x].row=y,matrixdisplay[y][x].addEventListener("mousedown",matrixMouseDown),tool.add(matrixdisplay[y][x]),bb=matrixdisplay[y][x].getBB(),minisliders[y][x]=new MiniSlider(bb.left+Math.floor(bb.width/2),bb.top-1),minisliders[y][x].col=x,minisliders[y][x].row=y
,minisliders[y][x].zIndex=matrixdisplay[y][x].zIndex+1,minisliders[y][x].addEventListener("mousedown",sliderMouseHandler),minisliders[y][x].addEventListener("mousedrag",sliderMouseHandler),minisliders[y][x].isVisible=!1,tool.add(minisliders[y][x]),minisliders[y][x].xmin=-1,minisliders[y][x].xmax=1,minisliders[y][x].xspan=2,minisliders[y][x].setValue(matrixvalues[y][x]);bb=matrixdisplay[y][0].getBB(),middleY=(bb.top+bb.bottom)/2,rowarrows[y]=new RowArrow(bb.left-13,middleY,10,5),rowarrows[y].row=y,rowarrows[y].addEventListener("mousedown",arrowMouseDown),tool.add(rowarrows[y]),rowpositions[y]={left:rowarrows[y].bBox.left,top:bb.top,middle:middleY,bottom:bb.bottom,baseLine:matrixdisplay[y][0].anchorTop,right:basex+colspacing*cols}}basex-=25,basey+=rowspacing*(rows-1)+50,errorMsgDisplay=new Text(basex,basey),errorMsgDisplay.text="",errorMsgDisplay.textColor=Color.red,tool.add(errorMsgDisplay);var nlines=20;rowspacing=25,basex=550,basey=50;var callback1=function(){matrixvalues=deepCopy(solMat
[0]),upperTriangulate(matrixvalues,rows,cols),printAllSols(),goToSol(solMat.length-1),draw()};textSolTitle=new Text(basex,basey),textSolTitle.text="Solution",textSolTitle.addEventListener("mousedown",callback1),tool.add(textSolTitle),basey+=50;var callback2=function(val){goToSol(val.src.y)};for(y=0;y<nlines;y++)textSols[y]=new Text(basex,basey+rowspacing*y),textSols[y].text="",textSols[y].y=y,textSols[y].addEventListener("mousedown",callback2),tool.add(textSols[y]);textSols[0].text="initial",basex=800,basey=50,textStepsTitle=new Text(basex,basey),textStepsTitle.text="User steps",tool.add(textStepsTitle),basey+=50;var callback3=function(val){goToStep(val.src.y)};for(y=0;y<nlines;y++)textSteps[y]=new Text(basex,basey+rowspacing*y),textSteps[y].text="",textSteps[y].y=y,textSteps[y].addEventListener("mousedown",callback3),tool.add(textSteps[y]);textSteps[0].text="Initial",basey+=rowspacing*(nlines-1)+50;var undoButton=new Button(basex,basey,basex+100,basey+25);undoButton.text="Undo",undoButton
.addEventListener("mousedown",function(){if(userMat.length<=1)return;popStep(),printAllSteps(),goToStep(userMat.length-1),draw()}),tool.add(undoButton),textSolTitle.isSelected=!0;var hoverListener=makeHoverListener();textSolTitle.addEventListener("mousemove",hoverListener),textSolTitle.addEventListener("mouseup",hoverListener),ghostBuffer=document.createElement("canvas"),document.addEventListener("keydown",canvasKeyDown,!1)}function makeHoverListener(){var hoverCandidates=[].concat(textSolTitle,textSols,textSteps,stagingArrow,rowarrows),textHoverAction=function(){var hoverColor=Color.litegray;this.isHovered?(this.storeTextColor=this.textColor,this.textColor=hoverColor):this.textColor=this.storeTextColor,this.draw()},arrowHoverAction=function(){this.isHovered?(this.storeArrowColor=this.arrowColor,this.arrowColor=Color.solOrange):this.arrowColor=this.storeArrowColor,this.draw()},i,len=hoverCandidates.length;for(i=0;i<len;i++){var hc=hoverCandidates[i];hc instanceof Text?hc.addEventListener
("hover",textHoverAction):hc instanceof RowArrow&&hc.addEventListener("hover",arrowHoverAction)}return function(e){var mpos=e.mouse,i,len=hoverCandidates.length;for(i=0;i<len;i++){var hc=hoverCandidates[i],wasHovered=hc.isHovered||!1;hc.isHovered=hc.isVisible&&hc.isInside(mpos),wasHovered!==hc.isHovered&&hc.fireEvent("hover")}}}function deepCopy(arr){if(Array.isArray(arr)){var l=arr.length,newarr=new Array(l);for(var i=0;i<l;i++)newarr[i]=deepCopy(arr[i]);return newarr}return arr}function draw(){tool.setPaintOn("canvas"),tool.paint()}function radioButtonMouseDown(rb){radiobuttons.unselectAll(rb);var showScale=multiplyRB.isChecked||addRB.isChecked,showStage=addRB.isChecked;scalingLabel.isVisible=showScale,scalarInput.setVisibility(showScale),showScale&&isNaN(scalarInput.getFloat())&&(scalarInput.node.value=rowmult),stagingArrow.origRow=-1,stagingArrow.isVisible=!1;for(var x=0,cols=stagingDisplay.length;x<cols;x++)stagingDisplay[x].isVisible=showStage,stagingDisplay[x].text="--",stagingDisplay
[x].textColor=Color.white;draw()}function matrixMouseDown(param){var x=param.src.col,y=param.src.row;sliderVisibleX===x&&sliderVisibleY===y?hideVisibleSlider():showSlider(x,y)}function showSlider(x,y){hideVisibleSlider();if(editingDisabled)return makeHistoryError();var md=matrixdisplay[y][x];md.storeTextColor=md.textColor,md.textColor=Color.litegray,md.draw(),minisliders[y][x].isVisible=!0,minisliders[y][x].draw(),sliderVisibleX=x,sliderVisibleY=y}function hideVisibleSlider(){if(sliderVisibleX>=0){var md=matrixdisplay[sliderVisibleY][sliderVisibleX];md.textColor=md.storeTextColor,md.draw();var ms=minisliders[sliderVisibleY][sliderVisibleX];ms.isVisible=!1,tool.paintBox({left:ms.bBox.left,top:ms.bBox.top,right:ms.bBox.right,bottom:ms.bBox.bottom+ms.anchorTriangleHeight}),sliderVisibleX=-1,sliderVisibleY=-1}}function sliderMouseHandler(param){var x=param.src.col,y=param.src.row;matrixdisplay[y][x].clear(),matrixvalues[y][x]=minisliders[y][x].xvalue,matrixdisplay[y][x].text=matrixvalues[y]
[x].toFixed(2),matrixdisplay[y][x].draw()}function canvasKeyDown(event){var TABKEY=9,LEFTKEY=37,UPKEY=38,RIGHTKEY=39,DOWNKEY=40,ESCKEY=27,SPACEKEY=32,keycode=event.keyCode||event.charCode,x=sliderVisibleX,y=sliderVisibleY,xmax=minisliders[0].length,ymax=minisliders.length,noSliderVisible=x===-1&&y===-1,sliderChange=!1;keycode===TABKEY?(sliderChange=!0,event.shiftKey?(noSliderVisible&&(x=xmax,y=ymax-1),x--,x===-1&&(x=xmax-1,y--,y===-1&&(y=ymax-1))):(noSliderVisible&&(y=0),x++,x===xmax&&(x=0,y++,y===ymax&&(y=0)))):event.ctrlKey&&(keycode===RIGHTKEY?(sliderChange=!0,noSliderVisible&&(y=0),x++,x===xmax&&(x=0)):keycode===LEFTKEY?(sliderChange=!0,noSliderVisible&&(x=xmax,y=0),x--,x===-1&&(x=xmax-1)):keycode===DOWNKEY?(sliderChange=!0,noSliderVisible&&(x=0),y++,y===ymax&&(y=0)):keycode===UPKEY&&(sliderChange=!0,noSliderVisible&&(x=0,y=ymax),y--,y===-1&&(y=ymax-1)));if(sliderChange){showSlider(x,y),event.preventDefault();return}if(keycode===ESCKEY&&!noSliderVisible){hideVisibleSlider(),event.preventDefault
();return}if(!noSliderVisible){var ms=minisliders[y][x],fakempos={},diff=event.shiftKey?3:1;keycode===RIGHTKEY||keycode===UPKEY?fakempos.x=ms.wxvalue+diff:keycode===LEFTKEY||keycode===DOWNKEY?fakempos.x=ms.wxvalue-diff:keycode===SPACEKEY&&(fakempos.x=ms.wxvalue+diff,fakempos.x>ms.wxmax&&(fakempos.x=ms.wxmin));if(fakempos.x!==undefined){ms.getValue(fakempos),ms.draw(),ms.fireEvent("mousedrag",{src:ms}),event.preventDefault();return}}}function arrowMouseDown(param){hideVisibleSlider();if(editingDisabled)return makeHistoryError();switchRB.isChecked?beginRowDrag(param):multiplyRB.isChecked?multiplyRow(param):addRB.isChecked&&beginAddDrag(param)}function multiplyRow(param){var arrow=param.src,y=arrow.row,cols=matrixdisplay[y].length,temp=scalarInput.getFloat();if(isNaN(temp)){scalarInput.node.value=rowmult;return}rowmult=temp;for(var x=0;x<cols;x++)matrixvalues[y][x]*=rowmult,matrixdisplay[y][x].text=matrixvalues[y][x].toFixed(2);sourceRow=y,pushStep(MULT_STEP,sourceRow,rowmult),draw()}function addScaledRow
(destRow,factor,srcRow){var cols=matrixvalues[destRow].length,x,tempval;for(x=0;x<cols;x++)matrixvalues[destRow][x]+=factor*matrixvalues[srcRow][x],matrixdisplay[destRow][x].text=matrixvalues[destRow][x].toFixed(2)}function beginRowDrag(param){var arrow=param.src,y=arrow.row,cols=matrixdisplay[y].length,i;sourceRow=y,hideVisibleSlider(),arrow.draw();for(i=0;i<cols;i++)matrixdisplay[y][i].draw();var ghostX=arrow.bBox.left,bb=matrixdisplay[y][cols-1].getBB(),ghostY=bb.top,ghostWidth=bb.right-ghostX,ghostHeight=bb.bottom-ghostY;ghostBuffer.width=ghostWidth,ghostBuffer.height=ghostHeight;var buffctx=ghostBuffer.getContext("2d");buffctx.drawImage(tool.canvas,ghostX,ghostY,ghostWidth,ghostHeight,0,0,ghostWidth,ghostHeight),arrow.storeAnchorLeft=arrow.anchorLeft,arrow.setAnchor(-10,arrow.anchorTop);for(i=0;i<cols;i++)matrixdisplay[y][i].isVisible=!1;var config={row:y,origRow:y,dx:param.mouse.x-ghostX,dy:param.mouse.y-ghostY,ghostX:ghostX,ghostY:ghostY,ghostWidth:ghostWidth,ghostHeight:ghostHeight
,mode:SWITCH_STEP,eventHandler:arrow};arrow.isSelected=!0;var handlers=makeDragHandlers(config);arrow.addEventListener("mousemove",handlers.mm),arrow.addEventListener("mouseup",handlers.mu)}function beginAddDrag(param){var arrow=param.src,fromStaging=arrow.row===-1,y=fromStaging?arrow.origRow:arrow.row,cols=matrixdisplay[y].length,i;sourceRow=y;if(!fromStaging){var temp=scalarInput.getFloat();isNaN(temp)&&(scalarInput.node.value=rowmult),rowmult=temp;var tempval,temptext,tempcol;for(var x=0;x<cols;x++){stagingDisplay[x].clear(),tempval=matrixvalues[y][x]*rowmult,temptext=tempval.toFixed(2);var color=Color.white;tempval<0?tempcol=Color.red:tempval>0&&(tempcol=Color.green,temptext="+"+temptext),stagingDisplay[x].text=temptext,stagingDisplay[x].textColor=tempcol,stagingDisplay[x].draw()}stagingArrow.isVisible=!0,stagingArrow.origRow=y,stagingArrow.draw()}var ghostX=arrow.bBox.left,rowClicked=fromStaging?stagingDisplay:matrixdisplay[y],ghostY=rowClicked[0].getBB().top,ghostWidth=stagingPosition
.right-stagingPosition.left,ghostHeight=stagingPosition.bottom-stagingPosition.top;ghostBuffer.width=ghostWidth,ghostBuffer.height=ghostHeight;var buffctx=ghostBuffer.getContext("2d");buffctx.drawImage(tool.canvas,stagingPosition.left,stagingPosition.top,ghostWidth,ghostHeight,0,0,ghostWidth,ghostHeight);var config={row:y,origRow:y,dx:param.mouse.x-ghostX,dy:param.mouse.y-ghostY,ghostX:ghostX,ghostY:ghostY,ghostWidth:ghostWidth,ghostHeight:ghostHeight,mode:ADD_STEP,eventHandler:arrow};arrow.isSelected=!0;var handlers=makeDragHandlers(config);arrow.addEventListener("mousemove",handlers.mm),arrow.addEventListener("mouseup",handlers.mu)}function nearestRow(x,y){var ret=0,rowpos,shortestDist=Math.abs(rowpositions[0].middle-y);for(var i=0,len=rowpositions.length;i<len;i++){rowpos=rowpositions[i];var idist=Math.abs(y-rowpos.middle);idist<shortestDist&&(ret=i,shortestDist=idist)}var maxDist=rowpositions[1].middle-rowpositions[0].middle;shortestDist>maxDist&&(ret=-1),maxDist*=2;if(x<rowpositions
[0].left-maxDist||x>rowpositions[0].right+maxDist)ret=-1;return ret}function swapPair(row1,row2){var tempvals=matrixvalues[row1],tempmd=matrixdisplay[row1],tempms=minisliders[row1],temparrow=rowarrows[row1];matrixvalues[row1]=matrixvalues[row2],matrixdisplay[row1]=matrixdisplay[row2],minisliders[row1]=minisliders[row2],rowarrows[row1]=rowarrows[row2],matrixvalues[row2]=tempvals,matrixdisplay[row2]=tempmd,minisliders[row2]=tempms,rowarrows[row2]=temparrow,positionRow(row1),positionRow(row2)}function positionRow(y){var pos=rowpositions[y];for(var x=0,cols=matrixdisplay[y].length;x<cols;x++){matrixdisplay[y][x].anchorTop=pos.baseLine,matrixdisplay[y][x].row=y,matrixdisplay[y][x].getBB();var aleft=minisliders[y][x].anchorLeft,atop=matrixdisplay[y][x].bBox.top-1;minisliders[y][x].setAnchor(aleft,atop),minisliders[y][x].row=y}rowarrows[y].setAnchor(rowarrows[y].anchorLeft,pos.middle),rowarrows[y].row=y}function moveRow(from,to){var y,ret=[];if(from<to){for(y=from;y<to;y++)swapPair(y,y+1),ret.
push(y);ret.push(to)}else if(from>to){for(y=from;y>to;y--)swapPair(y-1,y),ret.push(y);ret.push(to)}return ret}function previewAddRow(orig,from,to){if(from===to)return[];var ret=[];return from!==orig&&from!==-1&&(addScaledRow(from,-rowmult,orig),ret.push(from)),to!==orig&&to!==-1&&(addScaledRow(to,rowmult,orig),ret.push(to)),ret}var INITIAL=0,SWITCH_STEP=1,MULT_STEP=2,ADD_STEP=3,sourceRow,destRow,rowmult=1.5,steps=[];pushStep(INITIAL,0,1,0);var currentStep=0,sols=[];pushSol(INITIAL,0,1,0);function pushStep(type,srcRow,mult,destRow){type!==INITIAL&&userMat.push(deepCopy(matrixvalues)),type===SWITCH_STEP?steps.push({type:SWITCH_STEP,srcRow:srcRow,mult:mult,destRow:destRow}):type===MULT_STEP?steps.push({type:MULT_STEP,srcRow:srcRow,mult:mult,destRow:destRow}):type===ADD_STEP?steps.push({type:ADD_STEP,srcRow:srcRow,mult:mult,destRow:destRow}):type===INITIAL&&steps.push({type:INITIAL,srcRow:srcRow,mult:mult,destRow:destRow}),currentStep++,printAllSteps(),tool!==undefined&&draw()}function pushSol
(type,srcRow,mult,destRow){type!==INITIAL&&solMat.push(deepCopy(matrixvalues)),type===SWITCH_STEP?sols.push({type:SWITCH_STEP,srcRow:srcRow,mult:mult,destRow:destRow}):type===MULT_STEP?sols.push({type:MULT_STEP,srcRow:srcRow,mult:mult,destRow:destRow}):type===ADD_STEP?sols.push({type:ADD_STEP,srcRow:srcRow,mult:mult,destRow:destRow}):type===INITIAL&&sols.push({type:INITIAL,srcRow:srcRow,mult:mult,destRow:destRow})}function popStep(){steps.pop(),userMat.pop()}function stepBack(){currentStep!==0?currentStep--:window.alert("You are at the beginning.")}function stepForward(){currentStep!==steps.length?currentStep++:window.alert("You are at the end.")}function printAllSteps(){var str,i;for(i=0;i<textSteps.length;i++)i<steps.length?str=getStepStr(steps[i].type,steps[i].srcRow,steps[i].mult,steps[i].destRow):str="",textSteps[i].text=str}function printAllSols(){var str,i;for(i=0;i<textSols.length;i++)i<sols.length?str=getStepStr(sols[i].type,sols[i].srcRow,sols[i].mult,sols[i].destRow):str="",textSols
[i].text=str}function getStepStr(type,srcRow,mult,destRow){srcRow+=1,destRow+=1;if(type===SWITCH_STEP)return"L"+srcRow.toString()+" <=> "+"L"+destRow.toString();if(type===MULT_STEP)return mult.toFixed(2)+"L"+srcRow.toString()+" => "+"L"+srcRow.toString();if(type===ADD_STEP)return mult.toFixed(2)+"L"+srcRow.toString()+" + "+"L"+destRow.toString()+" => "+"L"+destRow.toString();if(type===INITIAL)return"initial"}function goToStep(pos){matrixvalues=deepCopy(userMat[pos]);for(var x,y=0;y<rows;y++)for(x=0;x<cols;x++)matrixdisplay[y][x].text=matrixvalues[y][x].toFixed(2);editingDisabled=pos!==userMat.length-1,errorMsgDisplay.text="",draw()}function goToSol(pos){matrixvalues=deepCopy(solMat[pos]);for(var x,y=0;y<rows;y++)for(x=0;x<cols;x++)matrixdisplay[y][x].text=matrixvalues[y][x].toFixed(2);editingDisabled=!0,errorMsgDisplay.text="",draw()}function makeHistoryError(){errorMsgDisplay.text="Cannot edit entries in history mode; go to newest step in user steps",errorMsgDisplay.draw()}function upperTriangulate
(A,m,n){var i,j,k,l,q;for(i=0;i<m;i++){var maxRow=i;for(k=i+1;k<m;k++)Math.abs(A[k][i])>Math.abs(A[maxRow][i])&&(maxRow=k);maxRow!==i&&(swapRows(A,i,maxRow),pushSol(SWITCH_STEP,i,1,maxRow)),q=1/A[i][i];for(l=i;l<n;l++)A[i][l]*=q;pushSol(MULT_STEP,i,q,i);for(k=i+1;k<m;k++){q=A[k][i];for(l=i;l<n;l++)A[k][l]=A[k][l]-q*A[i][l];pushSol(ADD_STEP,i,-q,k)}}}function swapRows(a,r1,r2){var n=a[r1].length;for(var j=0;j<n;j++){var tmp=a[r2][j];a[r2][j]=a[r1][j],a[r1][j]=tmp}}function makeDragHandlers(drag){var mm=function(param){var newx=param.mouse.x-drag.dx,newy=param.mouse.y-drag.dy,newrow=nearestRow(newx,newy+drag.ghostHeight/2),changed=[];drag.mode!==SWITCH_STEP&&(changed=previewAddRow(drag.origRow,drag.row,newrow));var ghostBox={top:drag.ghostY-10,bottom:drag.ghostY+drag.ghostHeight+10,left:drag.ghostX-10,right:drag.ghostX+drag.ghostWidth+10};tool.paintBox(ghostBox);for(var i=0;i<changed.length;i++)tool.paintBox(rowpositions[changed[i]]);drag.ghostX=newx,drag.ghostY=newy,drag.row=newrow,tool.
ctx.save(),tool.ctx.globalAlpha=.6,tool.ctx.drawImage(ghostBuffer,0,0,ghostBuffer.width,ghostBuffer.height,drag.ghostX,drag.ghostY,ghostBuffer.width,ghostBuffer.height),tool.ctx.restore()},mu=function(param){if(drag.mode===SWITCH_STEP){var y=drag.origRow,arrow=rowarrows[y];arrow.setAnchor(arrow.storeAnchorLeft,arrow.anchorTop);for(var i=0,len=matrixdisplay[y].length;i<len;i++)matrixdisplay[y][i].isVisible=!0;drag.row!==drag.origRow&&drag.row!==-1&&swapPair(drag.row,drag.origRow)}drag.eventHandler.isSelected=!1,drag.eventHandler.removeEventListener("mousemove"),drag.eventHandler.removeEventListener("mouseup"),destRow=drag.row,destRow!==sourceRow&&destRow!==-1&&pushStep(drag.mode,sourceRow,rowmult,destRow),draw()};return{mm:mm,mu:mu}}})})(RequireJS.requirejs,RequireJS.require,RequireJS.define)