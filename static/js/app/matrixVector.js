(function(requirejs,require,define){define("app/matrixVector",["require","jquery","webfonts","utils","tool","color","checkbox","slider","vslider","text","label","graph"],function(require){var $=require("jquery"),WebFonts=require("webfonts"),U=require("utils"),Tool=require("tool"),Color=require("color"),Checkbox=require("checkbox"),Slider=require("slider"),VSlider=require("vslider"),Text=require("text"),Label=require("label"),Graph=require("graph"),tool,graph,vinxSlider,vinySlider,rSlider,thetaSlider,a11Slider,a12Slider,a21Slider,a22Slider,eigenlinesCb,eigenvectorsCb,vinTitle,vinLabel,vinxText,vinyText,voutTitle,voutLabel,voutxText,voutyText,eigenval1Text,eigenvect1xText,eigenvect1yText,eigenval2Text,eigenvect2xText,eigenvect2yText,matrixLabel,vinx=1,viny=1,voutx,vouty,r,theta,a11=1,a12=1,a21=1,a22=0,eigen;WebFonts.load(initializeTool);function initializeTool(){try{U.testForFeatures(!0,!1,!1),initTool(),draw()}catch(err){window.alert(err.toString()+" The tool is disabled.")}}function loadJSON
(){$.ajax({url:"config.json",dataType:"json",success:function(data){$.each(data,function(key,val){window.alert("key="+key+" "+"val="+val)})}})}function initTool(){var daimpCanvas=document.getElementById("daimp");daimpCanvas.onselectstart=function(){return!1};var daimpBuffer=document.createElement("canvas");daimpBuffer.width=daimpCanvas.width,daimpBuffer.height=daimpCanvas.height;var element=daimpCanvas;tool=new Tool(800,800,daimpCanvas,daimpBuffer,element),graph=new Graph(90,40,390,340),setGraph(),graph.addEventListener("mousedown",graphMouseDown),graph.addEventListener("mousedrag",graphMouseDrag),tool.add(graph),initialize(),vinySlider=new VSlider(40,0,80,380),vinySlider.addEventListener("mousedown",vinySliderMouseDown),vinySlider.addEventListener("mousedrag",vinySliderMouseDown),tool.add(vinySlider),vinxSlider=new Slider(50,350,430,390),vinxSlider.addEventListener("mousedown",vinxSliderMouseDown),vinxSlider.addEventListener("mousedrag",vinxSliderMouseDown),tool.add(vinxSlider),rSlider=new 
Slider(50,450,370,490),rSlider.addEventListener("mousedown",rSliderMouseDown),rSlider.addEventListener("mousedrag",rSliderMouseDown),tool.add(rSlider),thetaSlider=new Slider(50,500,370,540),thetaSlider.addEventListener("mousedown",thetaSliderMouseDown),thetaSlider.addEventListener("mousedrag",thetaSliderMouseDown),tool.add(thetaSlider),a11Slider=new Slider(500,200,700,240),a11Slider.addEventListener("mousedown",a11SliderMouseDown),a11Slider.addEventListener("mousedrag",a11SliderMouseDown),tool.add(a11Slider),a12Slider=new Slider(700,200,900,240),a12Slider.addEventListener("mousedown",a12SliderMouseDown),a12Slider.addEventListener("mousedrag",a12SliderMouseDown),tool.add(a12Slider),a21Slider=new Slider(500,250,700,290),a21Slider.addEventListener("mousedown",a21SliderMouseDown),a21Slider.addEventListener("mousedrag",a21SliderMouseDown),tool.add(a21Slider),a22Slider=new Slider(700,250,900,290),a22Slider.addEventListener("mousedown",a22SliderMouseDown),a22Slider.addEventListener("mousedrag"
,a22SliderMouseDown),tool.add(a22Slider),setSliders(),vinTitle=new Text(543,60,0,0),vinTitle.text="Input vector",vinTitle.textColor=Color.yellow,vinTitle.textAlign="center",tool.add(vinTitle),vinxText=new Text(528,100,0,0),vinxText.text="1.00",vinxText.textColor=Color.yellow,tool.add(vinxText),vinyText=new Text(528,130,0,0),vinyText.text="1.00",vinyText.textColor=Color.yellow,tool.add(vinyText),vinLabel=new Text(478,115,0,0),vinLabel.text="v = ",vinLabel.textColor=Color.yellow,tool.add(vinLabel),voutTitle=new Text(775,60,0,0),voutTitle.text="Output vector",voutTitle.textColor=Color.cyan,voutTitle.textAlign="center",tool.add(voutTitle),voutxText=new Text(760,100,0,0),voutxText.text="2.00",voutxText.textColor=Color.cyan,tool.add(voutxText),voutyText=new Text(760,130,0,0),voutyText.text="1.00",voutyText.textColor=Color.cyan,tool.add(voutyText),voutLabel=new Text(700,115,0,0),voutLabel.text="Av = ",voutLabel.textColor=Color.cyan,tool.add(voutLabel),matrixLabel=new Text(478,255,0,0),matrixLabel
.text="A = ",matrixLabel.textColor=Color.green,tool.add(matrixLabel),eigenlinesCb=new Checkbox(478,364,490,376),eigenlinesCb.text="Eigenlines",eigenlinesCb.textColor=Color.green,eigenlinesCb.addEventListener("mousedown",checkboxMouseDown),tool.add(eigenlinesCb),eigenvectorsCb=new Checkbox(478,464,490,476),eigenvectorsCb.text="Eigenvectors",eigenvectorsCb.textColor=Color.green,eigenvectorsCb.addEventListener("mousedown",checkboxMouseDown),eigenvectorsCb.isVisible=!1,tool.add(eigenvectorsCb),eigenval1Text=new Text(478,530,0,0),eigenval1Text.hasSubSuperscript=!0,eigenval1Text.text="\u03bb_{1} = ",eigenval1Text.textColor=Color.green,eigenval1Text.isVisible=!1,tool.add(eigenval1Text),eigenvect1xText=new Text(578,530,0,0),eigenvect1xText.hasSubSuperscript=!0,eigenvect1xText.text="e_{1x} = ",eigenvect1xText.textColor=Color.green,eigenvect1xText.isVisible=!1,tool.add(eigenvect1xText),eigenvect1yText=new Text(678,530,0,0),eigenvect1yText.hasSubSuperscript=!0,eigenvect1yText.text="e_{1y} = ",eigenvect1yText
.textColor=Color.green,eigenvect1yText.isVisible=!1,tool.add(eigenvect1yText),eigenval2Text=new Text(478,560,0,0),eigenval2Text.hasSubSuperscript=!0,eigenval2Text.text="\u03bb_{0} = ",eigenval2Text.textColor=Color.green,eigenval2Text.isVisible=!1,tool.add(eigenval2Text),eigenvect2xText=new Text(578,560,0,0),eigenvect2xText.hasSubSuperscript=!0,eigenvect1xText.text="e2_{x} = ",eigenvect2xText.textColor=Color.green,eigenvect2xText.isVisible=!1,tool.add(eigenvect2xText),eigenvect2yText=new Text(678,560,0,0),eigenvect2yText.hasSubSuperscript=!0,eigenvect1yText.text="e2_{y} = ",eigenvect2yText.textColor=Color.green,eigenvect2yText.isVisible=!1,tool.add(eigenvect2yText)}function initialize(){r=calculateR(),theta=calculateTheta(),voutx=calculatevoutx(),vouty=calculatevouty(),eigen=getEigen()}function setSliders(){vinxSlider.xmin=-6,vinxSlider.xmax=6,vinxSlider.xspan=12,vinxSlider.setValue(vinx),vinxSlider.shortTickStep=0,vinxSlider.longTickStep=1,vinxSlider.labelStep=1,vinxSlider.text="x",vinxSlider
.textColor=Color.yellow,vinxSlider.valueDecimalDigits=2,vinxSlider.labelDecimalDigits=0,vinySlider.ymin=-6,vinySlider.ymax=6,vinySlider.yspan=12,vinySlider.setValue(viny),vinySlider.shortTickStep=0,vinySlider.longTickStep=1,vinySlider.labelStep=1,vinySlider.text="y",vinySlider.textColor=Color.yellow,vinySlider.valueDecimalDigits=2,vinySlider.labelDecimalDigits=0,rSlider.xmin=0,rSlider.xmax=8,rSlider.xspan=8,rSlider.setValue(r),rSlider.shortTickStep=0,rSlider.longTickStep=1,rSlider.labelStep=1,rSlider.text="r",rSlider.textColor=Color.yellow,rSlider.valueDecimalDigits=2,rSlider.labelDecimalDigits=0,thetaSlider.xmin=0,thetaSlider.xmax=2,thetaSlider.xspan=2,thetaSlider.setValue(theta),thetaSlider.shortTickStep=.5,thetaSlider.longTickStep=1,thetaSlider.labelStep=1,thetaSlider.text="\u03b8",thetaSlider.textColor=Color.yellow,thetaSlider.valueDecimalDigits=2,thetaSlider.automaticLabels=!1,thetaSlider.labels=[new Label(0,"0"),new Label(.5,"\u03c0 / 2"),new Label(1.5,"3\u03c0 / 2"),new Label(1,"\u03c0"
),new Label(2,"2\u03c0")],thetaSlider.hasPI=!0,a11Slider.xmin=-6,a11Slider.xmax=6,a11Slider.xspan=12,a11Slider.setValue(a11),a11Slider.shortTickStep=1,a11Slider.longTickStep=3,a11Slider.labelStep=3,a11Slider.text="",a11Slider.textColor=Color.green,a11Slider.valueDecimalDigits=1,a11Slider.labelDecimalDigits=0,a12Slider.xmin=-6,a12Slider.xmax=6,a12Slider.xspan=12,a12Slider.setValue(a12),a12Slider.shortTickStep=1,a12Slider.longTickStep=3,a12Slider.labelStep=3,a12Slider.text="",a12Slider.textColor=Color.green,a12Slider.valueDecimalDigits=1,a12Slider.labelDecimalDigits=0,a21Slider.xmin=-6,a21Slider.xmax=6,a21Slider.xspan=12,a21Slider.setValue(a21),a21Slider.shortTickStep=1,a21Slider.longTickStep=3,a21Slider.labelStep=3,a21Slider.text="",a21Slider.textColor=Color.green,a21Slider.valueDecimalDigits=1,a21Slider.labelDecimalDigits=0,a22Slider.xmin=-6,a22Slider.xmax=6,a22Slider.xspan=12,a22Slider.setValue(a22),a22Slider.shortTickStep=1,a22Slider.longTickStep=3,a22Slider.labelStep=3,a22Slider.text=""
,a22Slider.textColor=Color.green,a22Slider.valueDecimalDigits=1,a22Slider.labelDecimalDigits=0}function setGraph(){graph.xText="x",graph.yText="y",graph.xmin=-6,graph.xmax=6,graph.xspan=12,graph.xShortTickMin=0,graph.xShortTickMax=0,graph.xShortTickStep=0,graph.xLongTickMin=0,graph.xLongTickMax=0,graph.xLongTickStep=0,graph.xLabelMin=0,graph.xLabelMax=1,graph.xLabelStep=0,graph.xGridMin=-5,graph.xGridMax=5,graph.xGridStep=1,graph.xLabelDecimalDigits=0,graph.ymin=-6,graph.ymax=6,graph.yspan=12,graph.yShortTickMin=0,graph.yShortTickMax=9,graph.yShortTickStep=0,graph.yLongTickMin=0,graph.yLongTickMax=0,graph.yLongTickStep=0,graph.yLabelMin=0,graph.yLabelMax=1,graph.yLabelStep=0,graph.yGridMin=-5,graph.yGridMax=5,graph.yGridStep=1,graph.yLabelDecimalDigits=0,graph.x0=0,graph.y0=0,graph.showHorizontalCrosshair=!1,graph.showVerticalCrosshair=!1}function generateBuffer(){}function vinxSliderMouseDown(){vinx=vinxSlider.xvalue,r=calculateR(),theta=calculateTheta(),voutx=calculatevoutx(),vouty=calculatevouty
(),rSlider.setValue(r),thetaSlider.setValue(theta/Math.PI),update()}function vinySliderMouseDown(){viny=vinySlider.yvalue,r=calculateR(),theta=calculateTheta(),voutx=calculatevoutx(),vouty=calculatevouty(),rSlider.setValue(r),thetaSlider.setValue(theta/Math.PI),update()}function rSliderMouseDown(){r=rSlider.xvalue,vinx=calculatevinx(),viny=calculateviny(),voutx=calculatevoutx(),vouty=calculatevouty(),vinxSlider.setValue(vinx),vinySlider.setValue(viny),update()}function thetaSliderMouseDown(){theta=Math.PI*thetaSlider.xvalue,vinx=calculatevinx(),viny=calculateviny(),voutx=calculatevoutx(),vouty=calculatevouty(),vinxSlider.setValue(vinx),vinySlider.setValue(viny),update()}function a11SliderMouseDown(){a11=a11Slider.xvalue,voutx=calculatevoutx(),vouty=calculatevouty(),eigen=getEigen(),update()}function a12SliderMouseDown(){a12=a12Slider.xvalue,voutx=calculatevoutx(),vouty=calculatevouty(),eigen=getEigen(),update()}function a21SliderMouseDown(){a21=a21Slider.xvalue,voutx=calculatevoutx(),vouty=
calculatevouty(),eigen=getEigen(),update()}function a22SliderMouseDown(){a22=a22Slider.xvalue,voutx=calculatevoutx(),vouty=calculatevouty(),eigen=getEigen(),update()}function graphMouseDown(args){vinx=args.x,viny=args.y,r=calculateR(),theta=calculateTheta(),voutx=calculatevoutx(),vouty=calculatevouty(),vinxSlider.setValue(vinx),vinySlider.setValue(viny),rSlider.setValue(r),thetaSlider.setValue(theta/Math.PI),update()}function graphMouseDrag(args){vinx=args.x,viny=args.y,vinx>graph.xmax?vinx=graph.xmax:vinx<graph.xmin&&(vinx=graph.xmin),viny>graph.ymax?viny=graph.ymax:viny<graph.ymin&&(viny=graph.ymin),r=calculateR(),theta=calculateTheta(),voutx=calculatevoutx(),vouty=calculatevouty(),vinxSlider.setValue(vinx),vinySlider.setValue(viny),rSlider.setValue(r),thetaSlider.setValue(theta/Math.PI),update()}function checkboxMouseDown(){eigenlinesCb.isChecked?eigenvectorsCb.isVisible=!0:eigenvectorsCb.isVisible=!1,draw()}function calculateR(){return Math.sqrt(vinx*vinx+viny*viny)}function calculateTheta
(){var ang=Math.atan2(viny,vinx);return ang>=0?ang:2*Math.PI+ang}function phase(x,y){var ang=Math.atan2(y,x);return ang>=0?ang:2*Math.PI+ang}function isCloseToEigenvector(e){return Math.abs(phase(e.x,e.y)-phase(vinx,viny))}function calculatevinx(){return r*Math.cos(theta)}function calculateviny(){return r*Math.sin(theta)}function calculatevoutx(){return a11*vinx+a12*viny}function calculatevouty(){return a21*vinx+a22*viny}function Eigen(lambda,x,y){this.val=lambda,this.x=x,this.y=y}function getDeterminant(m11,m12,m21,m22){return m11*m22-m12*m21}function getEigen(){var b=a11+a22,c=a11*a22-a12*a21,det=b*b-4*c,e1,e2,lambda,result=[];return det>0?(lambda=(b-Math.sqrt(det))/2,a12!==0?e1=new Eigen(lambda,1,-(a11-lambda)/a12):a22!==0&&(e1=new Eigen(lambda,1,-(a21-lambda)/a22)),lambda=(b+Math.sqrt(det))/2,a12!==0?e2=new Eigen(lambda,1,-(a11-lambda)/a12):a22!==0&&(e2=new Eigen(lambda,1,-(a21-lambda)/a22)),result[0]=e1,result[1]=e2):det===0&&(lambda=b/2,a12!==0?e1=new Eigen(lambda,1,-(a11-lambda)/
a12):a22!==0&&(e1=new Eigen(lambda,1,-(a21-lambda)/a22)),result[0]=e1),result}function update(){updateGraph(),updateSliders(),updateTexts()}function updateGraph(){graph.updateDrawingZone(),Math.sqrt(vinx*vinx+viny*viny)!==0?graph.drawArrow(0,0,vinx,viny,Color.yellow):graph.drawPoint(0,0,Color.yellow),Math.sqrt(voutx*voutx+vouty*vouty)!==0?graph.drawArrow(0,0,voutx,vouty,Color.cyan):graph.drawPoint(0,0,Color.cyan),eigenlinesCb.isChecked&&drawEigenvalues()}function drawEigenvalues(){var eigenbis=[],minAngle,minAngleIndex,angle,color,alpha;if(eigen.length===2){eigenbis[0]=new Eigen(eigen[0].val,-eigen[0].x,-eigen[0].y),eigenbis[1]=new Eigen(eigen[1].val,-eigen[1].x,-eigen[1].y),angle=[],angle[0]=isCloseToEigenvector(eigen[0]),angle[1]=isCloseToEigenvector(eigenbis[0]),angle[2]=isCloseToEigenvector(eigen[1]),angle[3]=isCloseToEigenvector(eigenbis[1]),minAngle=Number.MAX_VALUE,minAngleIndex=-1;for(var i=0;i<4;i++)angle[i]<minAngle&&(minAngle=angle[i],minAngleIndex=i);alpha=1-4*minAngle/Math.
PI,color=Color.green,graph.ctx.save(),graph.ctx.globalAlpha=alpha,minAngleIndex===0||minAngleIndex===1?minAngle<Math.PI/4&&(graph.drawLine(0,0,100*eigen[0].x,100*eigen[0].y,color),graph.drawLine(0,0,100*eigenbis[0].x,100*eigenbis[0].y,color)):minAngle<Math.PI/4&&(graph.drawLine(0,0,100*eigen[1].x,100*eigen[1].y,color),graph.drawLine(0,0,100*eigenbis[1].x,100*eigenbis[1].y,color)),graph.ctx.restore()}else eigen.length===1&&(eigenbis[0]=new Eigen(eigen[0].val,-eigen[0].x,-eigen[0].y),angle=[],angle[0]=isCloseToEigenvector(eigen[0]),angle[1]=isCloseToEigenvector(eigenbis[0]),minAngle=Math.min(angle[0],angle[1]),alpha=1-4*minAngle/Math.PI,color=Color.green,graph.ctx.save(),graph.ctx.globalAlpha=alpha,minAngle<Math.PI/4&&(graph.drawLine(0,0,100*eigen[0].x,100*eigen[0].y,color),graph.drawLine(0,0,100*eigenbis[0].x,100*eigenbis[0].y,color)),graph.ctx.restore())}function updateSliders(){vinxSlider.draw(),vinySlider.draw(),rSlider.draw(),thetaSlider.draw(),a11Slider.draw(),a12Slider.draw(),a21Slider
.draw(),a22Slider.draw()}function updateTexts(){vinxText.clear(),vinyText.clear(),vinxText.text=vinx.toFixed(2),vinyText.text=viny.toFixed(2),vinxText.draw(),vinyText.draw(),voutxText.clear(),voutyText.clear(),voutxText.text=voutx.toFixed(2),voutyText.text=vouty.toFixed(2),voutxText.draw(),voutyText.draw(),tool.drawLeftBracket(508,80,50,Color.yellow),tool.drawRightBracket(578,80,50,Color.yellow),tool.drawLeftBracket(740,80,50,Color.cyan),tool.drawRightBracket(810,80,50,Color.cyan),tool.drawLeftBracket(510,200,85,Color.green),tool.drawRightBracket(910,200,85,Color.green);var e1Str,e1xStr,e1yStr,e2Str,e2xStr,e2yStr;eigen.length===2?(e1Str=eigen[0].val.toFixed(2),e1xStr=eigen[0].x.toFixed(2),e1yStr=eigen[0].y.toFixed(2),e2Str=eigen[1].val.toFixed(2),e2xStr=eigen[1].x.toFixed(2),e2yStr=eigen[1].y.toFixed(2)):eigen.length===1?(e1Str=eigen[0].val.toFixed(2),e1xStr=eigen[0].x.toFixed(2),e1yStr=eigen[0].y.toFixed(2),e2Str="          ",e2xStr="          ",e2yStr="          "):(e1Str="          "
,e1xStr="          ",e1yStr="          ",e2Str="          ",e2xStr="          ",e2yStr="          "),eigenval1Text.text="\u03bb_{1} = "+e1Str,eigenvect1xText.text="e_{1x} = "+e1xStr,eigenvect1yText.text="e_{1y} = "+e1yStr,eigenval2Text.text="\u03bb_{2} = "+e2Str,eigenvect2xText.text="e_{2x} = "+e2xStr,eigenvect2yText.text="e_{2y} = "+e2yStr,eigenlinesCb.isChecked&&eigenvectorsCb.isChecked&&(eigenval1Text.draw(),eigenvect1xText.draw(),eigenvect1yText.draw(),eigenval2Text.draw(),eigenvect2xText.draw(),eigenvect2yText.draw())}function draw(){tool.setPaintOn("canvas"),tool.paint(),update()}})})(RequireJS.requirejs,RequireJS.require,RequireJS.define)